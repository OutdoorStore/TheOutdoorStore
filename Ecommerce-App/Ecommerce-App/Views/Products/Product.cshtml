@model Ecommerce_App.Models.Product

@using Microsoft.AspNetCore.Identity;
@using Ecommerce_App.Models;

@inject SignInManager<Customer> SignInManager;
@inject UserManager<Customer> UserManager;
@inject Ecommerce_App.Data.StoreDbContext _storeDbContext;

@{
    Layout = "_Layout";
    ViewData["Title"] = Model.Name;
}

<div id="productDetails">
    <div id="imageContainer"><img src="@Model.Image" /></div>
    <div id="textContainer">
        <div id="name">@Model.Name</div>
        <div id="price">@Model.Price</div>
        <div id="desc">@Model.Description</div>
    </div>
</div>


@*ADD to cart*@
<form asp-controller="Products" asp-action="AddProductToCart" method="post">
    <div class="row">
        <div class="col-3 offset-3">
            <input type="hidden" name="productId" value="@Model.Id" />
            <button type="submit" class="btn btn-primary">Add to Cart</button>
        </div>
    </div>
</form>

@*View Component*@

@if (SignInManager.IsSignedIn(User))
{
    var customer = await UserManager.GetUserAsync(User);
    var cart = _storeDbContext.Carts.FirstOrDefault(x => x.UserId == customer.Id);

    @if (_storeDbContext.CartItems.Where(c => c.CartId == cart.Id) != null)
    await Component.InvokeAsync("CartComp");
}

